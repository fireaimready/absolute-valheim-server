; =============================================================================
; Supervisor Configuration for Valheim Server
; Manages the server process and ensures proper lifecycle handling
; =============================================================================

[supervisord]
nodaemon=true
user=root
logfile=/var/log/valheim/supervisord.log
logfile_maxbytes=10MB
logfile_backups=3
loglevel=info
pidfile=/var/run/valheim/supervisord.pid

[unix_http_server]
file=/var/run/valheim/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/valheim/supervisor.sock

; -----------------------------------------------------------------------------
; Valheim Server Process
; -----------------------------------------------------------------------------
[program:valheim-server]
command=/opt/valheim/scripts/valheim-server start
directory=/opt/valheim/server
user=root
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=120
stopsignal=INT
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/valheim/server-stdout.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/var/log/valheim/server-stderr.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=HOME="/home/valheim",USER="valheim"

; -----------------------------------------------------------------------------
; Cron Daemon (for scheduled updates and backups)
; -----------------------------------------------------------------------------
[program:cron]
command=/usr/sbin/cron -f
user=root
autostart=true
autorestart=true
startsecs=1
startretries=5
stdout_logfile=/var/log/valheim/cron-stdout.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=1
stderr_logfile=/var/log/valheim/cron-stderr.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=1
